import{_ as N,V as R,a as T}from"./email-options.vue_vue_type_script_setup_true_lang-z14TXRDu.js";import{u as F,b as K,U as M,a as Y}from"./index-LJ8e8yHT.js";import{f as q,Y as j,r as y,a as C,K as G,i as d,y as H,o as w,v as V,x as r,h as o,I as m,s as J,A as g,B as h,L as $}from"./vendor-DwjfiTos.js";const O=["src"],P=m("span",null,null,-1),Q=q({__name:"forget-password",setup(I){const p=new M,c=new R,U=j(),i=F(),v=y(!1),f=y(!1),s=C({username:"",username_suffix:"@163.com",password:"",rpassword:"",verify_code:"",sms_code:"",verify_id:"",remember:!0}),b=y(),S=C({username:[{required:!0,message:"请输入邮箱",trigger:["blur"]}],password:[{required:!0,message:"请输入密码",trigger:["blur"]},{trigger:["blur","change"],validator:(l,e,n)=>{/^(?!.*\s)(?!^[\u4e00-\u9fa5]+$)(?!^[0-9]+$)(?!^[A-z]+$)(?!^[^A-z0-9]+$)^.{8,16}$/.test(e)?n():n(new Error("8~20位字母、数字或字符，至少包含两种"))}}],rpassword:[{required:!0,message:"请确认密码",trigger:["blur"]},{trigger:["blur","change"],validator:(l,e,n)=>{e.trim()===""?n(new Error("请再次输入密码")):e!==s.password?n(new Error("两次输入密码不一致!")):n()}}],verify_code:[{required:!0,message:"请输入图形验证码",trigger:["blur"]}],sms_code:[{required:!0,message:"请输入邮箱验证码",trigger:["blur"]}]}),t=C({id:"-",code:"",msg:"获取验证码",counter:60}),z=G(()=>s.username+s.username_suffix),B=()=>{b.value.validate(l=>{l&&p.forget({account:z.value,password:K(s.password),sms_code:s.sms_code}).then(e=>{i.$message({message:"密码重置成功，去登录",type:"success",duration:1e3}),U.push({path:"/login"})}).catch(e=>{i.$message({message:e.message,type:"error",duration:1e3}),e.message!=="验证码不正确"&&x(),v.value=!1})})},x=()=>{c.create({last_id:t.id?t.id:"-"}).then(l=>{t.id=l.id,t.code=l.code,s.verify_id=l.id})};x();const A=()=>{b.value.validateField(["email","verify_code"],l=>{l&&(f.value=!0,c.smsSend({account:z.value,verify_id:s.verify_id,verify_code:s.verify_code,type:"email"}).then(e=>{f.value=!1,i.$message({message:"验证码发送成功",duration:1e3,type:"success"}),t.msg="验证码发送成功";let n=setInterval(()=>{t.counter<=0?(clearInterval(n),t.msg="重新获取验证码",t.counter=60):(t.counter--,t.msg=`${t.counter}秒后可重发`)},1e3)}).catch(e=>{i.$message({message:e.message,type:"error",duration:1e3}),f.value=!1}))})};return(l,e)=>{const n=d("el-select"),_=d("el-input"),u=d("el-form-item"),k=d("el-button"),D=d("router-link"),E=d("el-form"),L=H("loading");return w(),V(E,{model:s,rules:S,ref_key:"formRef",ref:b,class:"login-form"},{default:r(()=>[o(u,{prop:"username"},{default:r(()=>[o(_,{modelValue:s.username,"onUpdate:modelValue":e[1]||(e[1]=a=>s.username=a),"prefix-icon":"User",placeholder:"邮箱账号",size:"large"},{append:r(()=>[o(n,{modelValue:s.username_suffix,"onUpdate:modelValue":e[0]||(e[0]=a=>s.username_suffix=a),placeholder:"请选择邮箱类型",style:{width:"120px"},size:"large"},{default:r(()=>[o(N)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),o(u,{class:"verify-code",prop:"verify_code"},{default:r(()=>[o(_,{modelValue:s.verify_code,"onUpdate:modelValue":e[2]||(e[2]=a=>s.verify_code=a),placeholder:"请输入图形验证码",size:"large"},null,8,["modelValue"]),m("img",{src:t.code,title:"看不清，点击图片换一张",alt:"",onClick:x},null,8,O)]),_:1}),o(u,{class:"email-code",prop:"sms_code"},{default:r(()=>[o(_,{modelValue:s.sms_code,"onUpdate:modelValue":e[3]||(e[3]=a=>s.sms_code=a),placeholder:"请输入邮箱验证码",size:"large"},{suffix:r(()=>[J((w(),V(k,{text:"",type:"primary",onClick:A,disabled:t.counter!==60},{default:r(()=>[g(h(t.msg),1)]),_:1},8,["disabled"])),[[L,f.value]])]),_:1},8,["modelValue"])]),_:1}),o(u,{prop:"password"},{default:r(()=>[o(_,{modelValue:s.password,"onUpdate:modelValue":e[4]||(e[4]=a=>s.password=a),"prefix-icon":"Lock","show-password":"",placeholder:"设置新密码(8-20位字母、数字或字符，至少包含两种)",size:"large"},null,8,["modelValue"])]),_:1}),o(u,{prop:"rpassword",style:{"margin-bottom":"10px"}},{default:r(()=>[o(_,{modelValue:s.rpassword,"onUpdate:modelValue":e[5]||(e[5]=a=>s.rpassword=a),"prefix-icon":"Lock","show-password":"",placeholder:"确认新密码",size:"large"},null,8,["modelValue"])]),_:1}),o(u,{prop:"remember",class:"register-enter"},{default:r(()=>[P,m("span",null,[g("返回，去 "),o(D,{to:"/login"},{default:r(()=>[g("登录")]),_:1})])]),_:1}),o(u,{class:"login_btn"},{default:r(()=>[o(k,{loading:v.value,type:"primary",size:"large",onClick:B},{default:r(()=>[g("确定重置")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}}),W={class:"login-header"},X=["src"],oe=q({__name:"forget",setup(I){const p=Y(),c=y("first");return(U,i)=>{const v=d("el-tab-pane"),f=d("el-tabs");return w(),V(T,null,{default:r(()=>[m("div",W,[m("div",null,[m("img",{src:$(p).systemConfig.website.logo,alt:"系统logo"},null,8,X),g(" "+h($(p).systemConfig.website.name||"轻快图片管理系统"),1)]),m("p",null,h($(p).systemConfig.website.desc||"图片上传+管理新体验的轻量级图片管理系统、图床系统"),1)]),o(f,{class:"type-tabs",modelValue:c.value,"onUpdate:modelValue":i[0]||(i[0]=s=>c.value=s)},{default:r(()=>[o(v,{label:"重置密码",name:"first"},{default:r(()=>[(w(),V(Q,{key:"first-"+c.value}))]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});export{oe as default};
