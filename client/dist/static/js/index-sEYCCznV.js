import{u as N,D as $,p as z,w as F,o as U}from"./index-LJ8e8yHT.js";import{_ as B}from"./index.vue_vue_type_style_index_0_lang-y_WjoTOh.js";import{f as S,K as O,a as b,r as J,w as A,v as D,x as s,i as d,o as w,h as o,A as v,g as q,I as R,L as E,z as I,F as G}from"./vendor-DwjfiTos.js";const K=[{align:"center",label:"名称",width:"",prop:"name"},{align:"center",label:"编码(唯一)",width:"",prop:"code"},{align:"center",label:"创建时间",width:"",prop:"createdAt"},{align:"center",label:"更新时间",width:"",prop:"updatedAt"}],L=S({__name:"EditDialog",props:{modelValue:{type:Boolean,default:!1},detail:{default:()=>({name:"",code:"",values:[],values_str:JSON.stringify([],null,"	")})}},emits:["update:modelValue","submit"],setup(h,{emit:y}){const u=h,a=y,g=new $,m=N(),i=O({get(){return u.modelValue},set(e){a("update:modelValue",e)}}),t=b({id:"",name:"",code:"",values:[],values_str:JSON.stringify([],null,"	")}),C=b({name:[{required:!0,message:"请输入字典名称",trigger:["blur"]}],code:[{required:!0,message:"请输入字典名称",trigger:["blur"]}],values_str:[{required:!0,message:"请输入字典名称",trigger:["blur"]}]}),V=J(null),f=()=>{i.value=!1},n=()=>{V.value.validate(e=>{if(e){const l={name:t.name,code:t.code,values:JSON.parse(t.values_str)};t.id?g.update({id:t.id,...l}).then(_=>{f(),a("submit"),m.$message({message:"更新成功",type:"success",duration:1e3})}):g.create(l).then(_=>{f(),a("submit"),m.$message({message:"创建成功",type:"success",duration:1e3})})}})};return A(()=>t.values_str,e=>{}),A(()=>u.detail,e=>{if(e){t.id=u.detail.id;for(let l in t)t[l]=u.detail[l]}},{immediate:!0}),(e,l)=>{const _=d("el-input"),c=d("el-form-item"),k=d("el-form"),r=d("el-button"),x=d("com-dialog");return w(),D(x,{modelValue:i.value,"onUpdate:modelValue":l[3]||(l[3]=p=>i.value=p),title:e.detail&&e.detail.id?"编辑字典":"新建字典",width:"700px","before-close":f},{action:s(()=>[o(r,{onClick:f},{default:s(()=>[v("取 消")]),_:1}),o(r,{type:"primary",onClick:n},{default:s(()=>[v("确 定")]),_:1})]),default:s(()=>[o(k,{ref_key:"formRef",ref:V,model:t,rules:C,"label-width":"80px","label-position":"left",class:"dict-form"},{default:s(()=>[o(c,{label:"字典名称",prop:"name"},{default:s(()=>[o(_,{modelValue:t.name,"onUpdate:modelValue":l[0]||(l[0]=p=>t.name=p),size:"large"},null,8,["modelValue"])]),_:1}),o(c,{label:"字典编码",prop:"code"},{default:s(()=>[o(_,{modelValue:t.code,"onUpdate:modelValue":l[1]||(l[1]=p=>t.code=p),size:"large"},null,8,["modelValue"])]),_:1}),o(c,{prop:"values_str",label:"字典内容",class:"inline-item"},{default:s(()=>[o(B,{modelValue:t.values_str,"onUpdate:modelValue":l[2]||(l[2]=p=>t.values_str=p)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),P={class:"backstage-account-user"},H=S({__name:"index",setup(h){const y=N(),u=new $,a=b({page:1,size:10,total:0,config:K,filters:{name:""},data:[]});let g=b({data:null});const m=b({edit:!1}),i=()=>{u.find({page:a.page,size:a.size,...a.filters}).then(n=>{a.total=n.total,a.data=n.items.map(e=>(e.values_str=JSON.stringify(e.values,null,"	"),e.createdAt=z(e.createdAt),e.updatedAt=z(e.updatedAt),e))})};i();const t=(n,e)=>{g.data=n,e!=="delete"?m.edit=!0:U().then(()=>{u.delete(n.id).then(l=>{y.$message({type:"success",duration:1e3,message:"删除成功"}),i()})})},C=()=>{F(a,i)},V=n=>{console.log(n)},f=()=>{for(let n in a.filters)a.filters[n]=typeof a.filters[n]=="number"?0:"";i()};return(n,e)=>{const l=d("el-input"),_=d("filter-item"),c=d("el-button"),k=d("table-page");return w(),q(G,null,[R("div",P,[o(k,{"table-data":a,onFilter:C,onReset:f,"is-index":!0,border:!0,onPageChange:i,onSelectChange:V,actionWidth:150},{filter:s(()=>[o(_,{text:"字典名称:"},{default:s(()=>[o(l,{modelValue:a.filters.name,"onUpdate:modelValue":e[0]||(e[0]=r=>a.filters.name=r),placeholder:"请输入字典名称"},null,8,["modelValue"])]),_:1})]),action:s(()=>[o(c,{type:"primary",onClick:e[1]||(e[1]=r=>t(null,"add"))},{default:s(()=>[v("新增")]),_:1})]),tableAction:s(({row:r})=>[o(c,{type:"primary",size:"small",onClick:x=>t(r,"edit")},{default:s(()=>[v("编辑")]),_:2},1032,["onClick"]),o(c,{type:"danger",size:"small",onClick:x=>t(r,"delete")},{default:s(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1},8,["table-data"])]),m.edit?(w(),D(L,{key:0,modelValue:m.edit,"onUpdate:modelValue":e[2]||(e[2]=r=>m.edit=r),detail:E(g).data,onSubmit:i},null,8,["modelValue","detail"])):I("",!0)],64)}}});export{H as default};
