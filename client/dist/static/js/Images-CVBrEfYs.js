import{f as J,K as Q,a as O,r as N,w as fe,v as b,x as a,i as r,o as i,h as l,A as p,I as o,g as w,C as I,B as x,F as A,L as te,ap as ve,z as U,O as ye,ae as be,s as he,a5 as ke,p as Ve,j as we,y as Ce,Y as $e,n as xe}from"./vendor-DwjfiTos.js";import{u as W,p as Z,o as E,q as ee,r as ze,l as De,e as Te}from"./index-lYYcvhZ6.js";import{A as ae}from"./Album-0Te0fKlD.js";import{I as le}from"./Image-RN-sZ7Xy.js";import{_ as Se,G as Ue}from"./DetailDialog.vue_vue_type_style_index_0_lang-rtrIBF6u.js";import"./dragBox-cYxTLZvC.js";import"./date-time-ZUNy4mC1.js";const Ae={class:"album-tags-dialog"},Be={class:"album-dialog-tags template-tags"},Re=o("p",null,"模板标签",-1),Ie={class:"album-dialog-tags"},Ye=o("p",null,"已选标签",-1),qe={class:"album-dialog-tags",style:{display:"flex","flex-direction":"column"}},Me=o("p",null,"新增标签",-1),Fe=J({__name:"TagDialog",props:{modelValue:{type:Boolean,default:!1},detail:{default:()=>({id:0})},tags:{}},emits:["update:modelValue","submit"],setup(j,{emit:D}){const k=j,T=D,C=new le,h=W(),v=Q({get(){return k.modelValue},set(g){T("update:modelValue",g)}}),t=O({type:"primary",value:""}),m=N([]);function c(){if(!t.type)return h.$message({message:"请选择标签类型",duration:1e3,type:"warning"});if(!t.value.trim())return h.$message({message:"请填写标签内容",duration:1e3,type:"warning"});m.value.some(u=>u.value===t.value&&u.type===t.type)&&h.$message({message:"该标签已存在",duration:1e3,type:"warning"}),m.value.push({type:t.type,value:t.value}),t.type="",t.value=""}const $=()=>{v.value=!1};function S(){C.update({id:k.detail.id,tags:m.value}).then(g=>{v.value=!1,T("submit")})}function Y(g){m.value.splice(g,1)}function _(g){m.value.push(g)}return fe(()=>k.detail,g=>{g&&(m.value=g.tags&&g.tags.length?[...g.tags]:[])},{immediate:!0}),(g,u)=>{const q=r("el-tag"),V=r("el-option"),P=r("el-select"),B=r("el-button"),M=r("com-dialog");return i(),b(M,{modelValue:v.value,"onUpdate:modelValue":u[2]||(u[2]=f=>v.value=f),title:"编辑标签",width:"700px","before-close":$},{action:a(()=>[l(B,{onClick:$},{default:a(()=>[p("取 消")]),_:1}),l(B,{type:"primary",onClick:S},{default:a(()=>[p("确 定")]),_:1})]),default:a(()=>[o("div",Ae,[o("div",Be,[Re,(i(!0),w(A,null,I(g.tags.tags.slice(1),(f,y)=>(i(),b(q,{key:"template-"+y,type:f.type,onClick:F=>_(f)},{default:a(()=>[p(x(f.value),1)]),_:2},1032,["type","onClick"]))),128))]),o("div",Ie,[Ye,(i(!0),w(A,null,I(m.value,(f,y)=>(i(),b(q,{key:"selected-"+y,type:f.type,closable:"",onClose:F=>Y(y)},{default:a(()=>[p(x(f.value),1)]),_:2},1032,["type","onClose"]))),128))]),o("div",qe,[Me,o("div",null,[l(te(ve),{modelValue:t.value,"onUpdate:modelValue":u[1]||(u[1]=f=>t.value=f),placeholder:"请输入标签内容"},{prepend:a(()=>[l(P,{modelValue:t.type,"onUpdate:modelValue":u[0]||(u[0]=f=>t.type=f),placeholder:"标签类型",style:{width:"110px"}},{default:a(()=>[l(V,{label:"primary",value:"primary"}),l(V,{label:"danger",value:"danger"}),l(V,{label:"success",value:"success"}),l(V,{label:"info",value:"info"}),l(V,{label:"warning",value:"warning"})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),l(B,{style:{"margin-top":"10px"},type:"primary",onClick:c},{default:a(()=>[p("确定新增")]),_:1})])])])]),_:1},8,["modelValue"])}}}),Le={class:"album-default-tags"},Pe={class:"tags-list"},Ee=o("p",null,"模板标签库",-1),Ne={class:"tags-manage"},je=o("p",null,"新增标签",-1),Ge=J({__name:"default-tags",props:{modelValue:{type:Boolean,default:!1},detail:{default:()=>({})}},emits:["update:modelValue","submit"],setup(j,{emit:D}){const k=j,T=D,C=W(),h=new ae,v=Q({get(){return k.modelValue},set(g){T("update:modelValue",g)}}),t=O({type:"",value:""}),m=N();m.value=k.detail.tags.slice(1);function c(){v.value=!1}function $(g,u){m.value.splice(u,1),Y()}function S(){if(!t.type)return C.$message({message:"请选择标签类型",duration:1e3,type:"warning"});if(!t.value.trim())return C.$message({message:"请填写标签内容",duration:1e3,type:"warning"});m.value.some(u=>u.value===t.value&&u.type===t.type)&&C.$message({message:"该标签已存在",duration:1e3,type:"warning"}),m.value.push({type:t.type,value:t.value}),t.type="",t.value="",Y()}function Y(){h.updateTags(k.detail.album_id,m.value).then(g=>{})}function _(){c(),T("submit")}return(g,u)=>{const q=r("el-tag"),V=r("el-option"),P=r("el-select"),B=r("el-input"),M=r("el-button"),f=r("com-dialog");return i(),b(f,{modelValue:v.value,"onUpdate:modelValue":u[2]||(u[2]=y=>v.value=y),title:"相册标签库",width:"700px","before-close":c},{action:a(()=>[l(M,{type:"primary",onClick:_},{default:a(()=>[p("关 闭")]),_:1})]),default:a(()=>[o("div",Le,[o("div",Pe,[Ee,(i(!0),w(A,null,I(m.value,(y,F)=>(i(),b(q,{key:F,type:y.type==="primary"?"":y.type,closable:"",onClose:X=>$(y,F)},{default:a(()=>[p(x(y.value),1)]),_:2},1032,["type","onClose"]))),128))]),o("div",Ne,[je,o("div",null,[l(B,{modelValue:t.value,"onUpdate:modelValue":u[1]||(u[1]=y=>t.value=y),placeholder:"请输入标签内容"},{prepend:a(()=>[l(P,{modelValue:t.type,"onUpdate:modelValue":u[0]||(u[0]=y=>t.type=y),placeholder:"标签类型",style:{width:"110px"}},{default:a(()=>[l(V,{label:"primary",value:"primary"}),l(V,{label:"danger",value:"danger"}),l(V,{label:"success",value:"success"}),l(V,{label:"info",value:"info"}),l(V,{label:"warning",value:"warning"})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),l(M,{type:"primary",onClick:S},{default:a(()=>[p("确定新增")]),_:1})])])])]),_:1},8,["modelValue"])}}}),Ke={class:"album-images"},Oe={class:"album-actions"},He={class:"album-actions-footer"},Je={class:"album-title"},Qe={class:"album-desc"},We={class:"album-meta"},Xe={class:"album-meta-line"},Ze=o("span",{class:"divider"},"|",-1),et={class:"album-meta-line"},tt={class:"album-image-content"},at={class:"album-image-filter"},lt={class:"filter-input"},st={key:0,class:"filter-tags"},nt=o("span",null,"标签搜索:",-1),ot=["onClick"],it={class:"album-image-list"},ut={class:"album-tags"},dt={key:1,class:"empty-data"},vt=J({__name:"Images",setup(j){const D=new ae,k=ke(),T=$e(),C=new le,h=W(),v=N({}),t=O({page:1,size:18,total:0,loading:!1,filters:{album_id:+k.query.id||0,tag:{type:"",value:"全部"},img_name:""},data:[]}),m=Q(()=>t.data.filter(s=>s.checked)),c=O({detail:!1,data:null,edit:!1,tags:!1}),$=N(null);function S(s=()=>{}){D.tags(+k.query.id).then(e=>{e&&($.value=e,$.value.tags.unshift({type:"primary",value:"全部"}),$.value.tags.includes(t.filters.tag)||(t.filters.tag={type:"",value:"全部"},s()))})}S();function Y(){const s=k.query.id;s&&(D.detail(+s).then(e=>{e&&(e.createdAt=Z(e.createdAt,"YYYY-MM-DD"),e.updatedAt=Z(e.updatedAt,"YYYY-MM-DD"),v.value=e)}),_())}Y();function _(){t.loading=!0,D.images({page:t.page,size:t.size,id:t.filters.album_id,name:t.filters.img_name,tag:t.filters.tag}).then(s=>{t.total=s.total,t.data=s.items.map(e=>(e.checked=!1,e.preview_url=e.baseurl+e.url,e)),t.loading=!1})}function g(){const s=t.data.filter(e=>e.checked)[0];Ve.prompt("请输入新的文件名","文件重命名",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^(?!\s*$).+/,inputErrorMessage:"请输入新的文件名，文件名不符合标准",inputType:"textarea",inputPlaceholder:"请输入新文件名",inputValue:s.origin_name}).then(({value:e})=>{C.update({id:s.id,origin_name:e}).then(d=>{h.$message({message:"重命名成功",duration:1e3,type:"success"}),_()})}).catch(()=>{})}function u(s){let e=[];switch(s){case"remove":e=m.value.map(d=>d.id),E("确定将图片移出该相册吗？").then(()=>{e.map((d,z)=>{C.update({id:d,album_id:null}).then(async G=>{z===e.length-1&&(h.$message({message:"移除成功",duration:1e3,type:"success"}),_())})})});break;case"delete":e=m.value.map(d=>d.id),E().then(()=>{e.map((d,z)=>{C.delete(d).then(G=>{z===e.length-1&&(h.$message({message:"删除成功",duration:1e3,type:"success"}),_())})})});break;case"cover":E("确定将该图片设置为相册封面吗？").then(()=>{D.update({id:t.filters.album_id,cover:m.value[0].preview_url}).then(d=>{h.$message({message:"封面设置成功",duration:1e3,type:"success"})})});break;case"tag":c.edit=!0,c.data=m.value[0];break}}function q(s){const e=m.value.map(d=>{const z={url:d.preview_url,filename:d.name};return s.value.replace(/\$\{(.*?)\}/g,(G,H)=>z[H])}).join(`
`);Te(h,e)}function V(s){h.$viewerApi({options:{initialViewIndex:s},images:t.data.map(e=>e.preview_url)})}function P(s){switch(s.type){case"delete":E("确定删除吗?(由于对象存储几乎不要钱，故此处只是删除本条记录，不会删除对象存储上的原数据，所以删除后仍然能正常访问)").then(()=>{C.delete(s.data.id).then(e=>{h.$message({message:"删除成功",type:"success",duration:1e3}),S(_)})});break;case"remove":E("确定将图片移出该相册吗？").then(()=>{C.update({id:s.data.id,album_id:"",sort:0}).then(async e=>{h.$message({message:"移除成功",type:"success",duration:1e3}),_()})});break;case"detail":c[s.type]=!0,c.data=s.data;break;case"update":ee(t,k.name,"set"),T.push({path:"/",query:{album_id:v.value.id,img_id:s.data.id}});break;case"tag":c.edit=!0,c.data=s.data;break}}function B(s){t.filters.tag=s,_()}function M(){ee(t,k.name,"set"),T.push({path:"/",query:{album_id:v.value.id}})}const f=N(!1);function y(){f.value=!f.value,F()}function F(){we(()=>{ze(document.querySelector("#sortableRef"),t.data,X)})}function X(s,e){t.loading=!0;const[d,z]=[t.data[s],t.data[e]];C.sort(d.id,z.id).then(()=>{_()})}return(s,e)=>{const d=r("el-button"),z=r("el-dropdown-item"),G=r("el-dropdown-menu"),H=r("el-dropdown"),se=r("Calendar"),K=r("el-icon"),ne=r("RefreshLeft"),oe=r("Picture"),ie=r("Search"),ue=r("el-input"),de=r("el-tag"),re=r("el-col"),me=r("el-row"),pe=r("el-empty"),ce=r("pagination"),ge=Ce("loading");return i(),w("div",Ke,[o("div",{class:"album-image-header",style:ye({"background-color":v.value.background||"#009688"})},[o("div",Oe,[l(d,{type:"primary",icon:"Back",onClick:e[0]||(e[0]=()=>s.$router.back())},{default:a(()=>[p("返回")]),_:1}),l(d,{type:"success",icon:"UploadFilled",onClick:M},{default:a(()=>[p("去上传")]),_:1})]),o("div",He,[l(d,{type:"info",icon:"Tools",size:"small",onClick:e[1]||(e[1]=n=>c.tags=!0)},{default:a(()=>[p("标签模板")]),_:1}),l(d,{size:"small",onClick:y},{default:a(()=>[p(x(f.value?"完成排序":"启用排序"),1)]),_:1}),m.value.length?(i(),w(A,{key:0},[m.value.length===1?(i(),b(d,{key:0,type:"warning",onClick:g},{default:a(()=>[p("重命名")]),_:1})):U("",!0),m.value.length===1?(i(),b(d,{key:1,type:"success",icon:"Picture",size:"small",onClick:e[2]||(e[2]=n=>u("cover"))},{default:a(()=>[p("设为封面")]),_:1})):U("",!0),m.value.length===1?(i(),b(d,{key:2,type:"success",icon:"Stamp",size:"small",onClick:e[3]||(e[3]=n=>u("tag"))},{default:a(()=>[p("标签管理")]),_:1})):U("",!0),l(H,{class:"copy-link-type",trigger:"click",onCommand:e[4]||(e[4]=n=>n())},{dropdown:a(()=>[l(G,null,{default:a(()=>[(i(!0),w(A,null,I(te(De),(n,R)=>(i(),b(z,{key:R,label:n.label,value:n.id,command:()=>q(n)},{default:a(()=>[p(x(n.label),1)]),_:2},1032,["label","value","command"]))),128))]),_:1})]),default:a(()=>[l(d,{type:"primary",icon:"DocumentCopy",size:"small"},{default:a(()=>[p("复制链接")]),_:1})]),_:1}),l(d,{type:"warning",icon:"Close",size:"small",onClick:e[5]||(e[5]=n=>u("remove"))},{default:a(()=>[p("移出相册")]),_:1}),l(d,{type:"danger",icon:"Delete",size:"small",onClick:e[6]||(e[6]=n=>u("delete"))},{default:a(()=>[p("删除所选")]),_:1})],64)):U("",!0)]),o("div",Je,x(v.value.name),1),o("div",Qe,x(v.value.desc),1),o("div",We,[o("div",Xe,[o("span",null,[l(K,null,{default:a(()=>[l(se)]),_:1}),p(" 创建于 "+x(v.value.createdAt),1)]),Ze,o("span",null,[l(K,null,{default:a(()=>[l(ne)]),_:1}),p(" 更新于 "+x(v.value.updatedAt),1)])]),o("div",et,[o("span",null,[l(K,null,{default:a(()=>[l(oe)]),_:1}),p(" 图片数量: "+x(t.total)+"张 ",1)])])])],4),o("div",tt,[o("div",at,[o("div",lt,[l(ue,{modelValue:t.filters.img_name,"onUpdate:modelValue":e[8]||(e[8]=n=>t.filters.img_name=n),size:"large",placeholder:"请输入搜索内容...",clearable:"",onKeyup:be(_,["enter"]),onClear:_},{append:a(()=>[l(d,{type:"primary",onClick:e[7]||(e[7]=()=>{t.page=1,_()})},{default:a(()=>[l(K,null,{default:a(()=>[l(ie)]),_:1}),p(" 搜索 ")]),_:1})]),_:1},8,["modelValue"])]),$.value.tags.length>=2?(i(),w("div",st,[nt,(i(!0),w(A,null,I($.value.tags,(n,R)=>(i(),w("span",{key:"filter-tag-"+R,class:xe(["filter-tag-item",n.value===t.filters.tag.value?"active":""]),onClick:L=>B(n)},x(n.value),11,ot))),128))])):U("",!0)]),he((i(),w("div",it,[t.data.length?(i(),b(me,{key:0,id:"sortableRef"},{default:a(()=>[(i(!0),w(A,null,I(t.data,(n,R)=>(i(),b(re,{key:"gallery-item-"+R+"-"+n.id,xl:4,lg:6,md:8,sm:12,xs:24,class:"drag-box-col"},{default:a(()=>[(i(),b(Ue,{data:n,remove:!0,editable:f.value,images:t.data.map(L=>L.preview_url),onReload:_,key:t.page+"-"+R+n.id,onSubmit:P,onView:L=>V(R)},{tags:a(()=>[o("div",ut,[(i(!0),w(A,null,I(n.tags,(L,_e)=>(i(),b(de,{size:"small",key:"tag-"+_e,type:L.type},{default:a(()=>[p(x(L.value),1)]),_:2},1032,["type"]))),128))])]),_:2},1032,["data","editable","images","onView"]))]),_:2},1024))),128))]),_:1})):(i(),w("div",dt,[l(pe,{description:"暂无数据"})]))])),[[ge,t.loading]]),(i(),b(ce,{key:t.page,page:t.page,"onUpdate:page":e[9]||(e[9]=n=>t.page=n),size:t.size,"onUpdate:size":e[10]||(e[10]=n=>t.size=n),total:t.total,"page-sizes":[18,36,72,100],onChange:_},null,8,["page","size","total"]))]),c.detail?(i(),b(Se,{key:0,modelValue:c.detail,"onUpdate:modelValue":e[11]||(e[11]=n=>c.detail=n),"show-album":!1,id:c.data.id,onSubmit:_},null,8,["modelValue","id"])):U("",!0),c.edit?(i(),b(Fe,{key:1,modelValue:c.edit,"onUpdate:modelValue":e[12]||(e[12]=n=>c.edit=n),detail:c.data,tags:$.value,onSubmit:e[13]||(e[13]=()=>{S(),_()})},null,8,["modelValue","detail","tags"])):U("",!0),c.tags?(i(),b(Ge,{key:2,modelValue:c.tags,"onUpdate:modelValue":e[14]||(e[14]=n=>c.tags=n),detail:$.value,onSubmit:S},null,8,["modelValue","detail"])):U("",!0)])}}});export{vt as default};
