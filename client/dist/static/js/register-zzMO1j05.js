import{_ as R,V as T,a as j}from"./email-options.vue_vue_type_script_setup_true_lang-Cy-CRHPE.js";import{u as F,U as K,a as Y}from"./index-08v4467x.js";import{f as q,Y as G,r as y,a as h,K as H,i,y as J,o as w,v as V,x as r,h as o,I as d,s as M,A as v,B as $,L as C}from"./vendor-DwjfiTos.js";const O=["src"],P={style:{display:"flex","align-items":"center"}},Q=d("span",null,"我同意",-1),W=d("a",{href:"javascript:;"},"《用户协议和隐私协议》",-1),X=q({__name:"register-password",setup(I){const f=new K,c=new T,U=G(),u=F(),_=y(!1),p=y(!1),e=h({username:"",username_suffix:"@163.com",password:"",rpassword:"",verify_code:"",sms_code:"",verify_id:"",remember:!1}),b=y(),S=h({username:[{required:!0,message:"请输入邮箱账号",trigger:["blur"]}],password:[{required:!0,message:"请输入密码",trigger:["blur"]},{trigger:["blur","change"],validator:(l,s,n)=>{/^(?!.*\s)(?!^[\u4e00-\u9fa5]+$)(?!^[0-9]+$)(?!^[A-z]+$)(?!^[^A-z0-9]+$)^.{8,16}$/.test(s)?n():n(new Error("8~20位字母、数字或字符，至少包含两种"))}}],rpassword:[{required:!0,message:"请确认密码",trigger:["blur"]},{trigger:["blur","change"],validator:(l,s,n)=>{s.trim()===""?n(new Error("请再次输入密码")):s!==e.password?n(new Error("两次输入密码不一致!")):n()}}],verify_code:[{required:!0,message:"请输入图形验证码",trigger:["blur"]}],sms_code:[{required:!0,message:"请输入邮箱验证码",trigger:["blur"]}]}),t=h({id:"-",code:"",msg:"获取验证码",counter:60}),k=H(()=>e.username+e.username_suffix),B=()=>{b.value.validate(l=>{if(l){if(!e.remember)return u.$message({message:"请同意协议",type:"warning",duration:1e3});_.value=!0,f.register({account:k.value,password:e.password,sms_code:e.sms_code}).then(s=>{u.$message({message:"注册成功，去登录吧",type:"success",duration:1e3}),U.push({path:"/login"})}).catch(s=>{u.$message({message:s.message,type:"error",duration:1e3}),s.message!=="验证码不正确"&&x(),_.value=!1})}})},x=()=>{c.create({last_id:t.id?t.id:"-"}).then(l=>{t.id=l.id,t.code=l.data,e.verify_id=l.id})};x();const A=()=>{b.value.validateField(["username","verify_code"],l=>{l&&(p.value=!0,c.smsSend({account:k.value,verify_id:e.verify_id,verify_code:e.verify_code,type:"email"}).then(s=>{p.value=!1,u.$message({message:"验证码发送成功",duration:1e3,type:"success"}),t.msg="验证码发送成功";let n=setInterval(()=>{t.counter<=0?(clearInterval(n),t.msg="重新获取验证码",t.counter=60):(t.counter--,t.msg=`${t.counter}秒后可重发`)},1e3)}).catch(s=>{u.$message({message:s.message,type:"error",duration:1e3}),p.value=!1}))})};return(l,s)=>{const n=i("el-select"),g=i("el-input"),m=i("el-form-item"),z=i("el-button"),D=i("el-checkbox"),E=i("router-link"),L=i("el-form"),N=J("loading");return w(),V(L,{model:e,rules:S,ref_key:"formRef",ref:b,class:"login-form"},{default:r(()=>[o(m,{prop:"username"},{default:r(()=>[o(g,{modelValue:e.username,"onUpdate:modelValue":s[1]||(s[1]=a=>e.username=a),"prefix-icon":"User",placeholder:"邮箱账号",size:"large"},{append:r(()=>[o(n,{modelValue:e.username_suffix,"onUpdate:modelValue":s[0]||(s[0]=a=>e.username_suffix=a),placeholder:"请选择邮箱类型",style:{width:"120px"},size:"large"},{default:r(()=>[o(R)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),o(m,{class:"verify-code",prop:"verify_code"},{default:r(()=>[o(g,{modelValue:e.verify_code,"onUpdate:modelValue":s[2]||(s[2]=a=>e.verify_code=a),placeholder:"请输入图形验证码",size:"large"},null,8,["modelValue"]),d("img",{src:t.code,title:"看不清，点击图片换一张",alt:"",onClick:x},null,8,O)]),_:1}),o(m,{class:"email-code",prop:"sms_code"},{default:r(()=>[o(g,{modelValue:e.sms_code,"onUpdate:modelValue":s[3]||(s[3]=a=>e.sms_code=a),placeholder:"请输入邮箱验证码",size:"large"},{suffix:r(()=>[M((w(),V(z,{text:"",type:"primary",onClick:A,disabled:t.counter!==60},{default:r(()=>[v($(t.msg),1)]),_:1},8,["disabled"])),[[N,p.value]])]),_:1},8,["modelValue"])]),_:1}),o(m,{prop:"password"},{default:r(()=>[o(g,{modelValue:e.password,"onUpdate:modelValue":s[4]||(s[4]=a=>e.password=a),"prefix-icon":"Lock","show-password":"",placeholder:"设置密码(8-20位字母、数字或字符，至少包含两种)",size:"large"},null,8,["modelValue"])]),_:1}),o(m,{prop:"rpassword",style:{"margin-bottom":"10px"}},{default:r(()=>[o(g,{modelValue:e.rpassword,"onUpdate:modelValue":s[5]||(s[5]=a=>e.rpassword=a),"prefix-icon":"Lock","show-password":"",placeholder:"确认密码",size:"large"},null,8,["modelValue"])]),_:1}),o(m,{prop:"remember",class:"register-enter"},{default:r(()=>[d("span",P,[o(D,{style:{"margin-right":"8px"},modelValue:e.remember,"onUpdate:modelValue":s[6]||(s[6]=a=>e.remember=a)},null,8,["modelValue"]),Q,W]),d("span",null,[v("已有账号, 去 "),o(E,{to:"/login"},{default:r(()=>[v("登录")]),_:1})])]),_:1}),o(m,{class:"login_btn"},{default:r(()=>[o(z,{loading:_.value,type:"primary",size:"large",onClick:B},{default:r(()=>[v("提交注册")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}}),Z={class:"login-header"},ee=["src"],te=q({__name:"register",setup(I){const f=Y(),c=y("first");return(U,u)=>{const _=i("el-tab-pane"),p=i("el-tabs");return w(),V(j,null,{default:r(()=>[d("div",Z,[d("div",null,[d("img",{src:C(f).systemConfig.website.logo,alt:"系统logo"},null,8,ee),v(" "+$(C(f).systemConfig.website.name||"轻快图片管理系统"),1)]),d("p",null,$(C(f).systemConfig.website.desc||"图片上传+管理新体验的轻量级图片管理系统、图床系统"),1)]),o(p,{class:"type-tabs",modelValue:c.value,"onUpdate:modelValue":u[0]||(u[0]=e=>c.value=e)},{default:r(()=>[o(_,{label:"通用账号注册",name:"first"},{default:r(()=>[(w(),V(X,{key:"first-"+c.value}))]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});export{te as default};
