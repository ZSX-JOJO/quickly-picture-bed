import{u as G,a as T,U as O,D as E,p as J,w as H,o as Q}from"./index-08v4467x.js";import{f as q,K as P,a as D,r as j,w as X,v as U,x as a,i as u,o as g,h as l,A as y,g as S,C as R,F as B,aa as Y,I,L,z as K,n as Z,B as M}from"./vendor-DwjfiTos.js";const x=[{align:"center",label:"chatgpt",width:"",prop:"config",slot:"chatgpt"},{align:"center",label:"用户名",width:"",prop:"username"},{align:"center",label:"角色",width:"",prop:"role_name"},{align:"center",label:"邮箱 | 账号",width:"",prop:"email"},{align:"center",label:"手机号",width:"",prop:"phone"},{align:"center",label:"性别",width:"",prop:"gender"},{align:"center",label:"职业",width:"",prop:"major"},{align:"center",label:"创建时间",width:"",prop:"createdAt"},{align:"center",label:"更新时间",width:"",prop:"updatedAt"}],ee=q({__name:"EditDialog",props:{modelValue:{type:Boolean,default:!1},detail:{default:()=>({email:"",role:2,username:"",phone:"",status:!0})}},emits:["update:modelValue","submit"],setup(F,{emit:k}){const f=F,C=k,r=new O,z=G(),c=T(),v=P({get(){return f.modelValue},set(t){C("update:modelValue",t)}}),d=D({id:"",username:"用户名称",email:"",role:1,phone:"",status:!0,avatar:"星座_白羊座",config:{chatgpt:!1}}),w=D({email:[{required:!0,message:"请输入邮箱",trigger:["blur"]},{validator:(t,o,s)=>{if(!/^\w{3,}(\.\w+)*@[A-z0-9]+(\.[A-z]{2,5}){1,2}$/.test(o))return s("邮箱格式不正确");s()}}],role:[{required:!0,message:"请勾选角色",trigger:["blur"]}]}),$=j(null),h=P(()=>c.dicts.find(t=>t.code==="user_role").values||[]),p=()=>{v.value=!1},e=()=>{$.value.validate(t=>{if(t){const o=JSON.parse(JSON.stringify(d));delete o.id,d.id?(delete o.email,delete o.phone,r.update({id:d.id,...o}).then(s=>{p(),C("submit"),z.$message({message:"更新成功",type:"success",duration:1e3})})):r.create({...o,password:"000000"}).then(s=>{p(),C("submit"),z.$message({message:"创建成功",type:"success",duration:1e3})})}})};return X(()=>f.detail,t=>{if(t){d.id=f.detail.id;for(let o in d)f.detail[o]&&f.detail[o]!==null&&(d[o]=f.detail[o])}},{immediate:!0}),(t,o)=>{const s=u("el-input"),V=u("el-form-item"),b=u("el-option"),A=u("el-select"),i=u("el-switch"),_=u("el-form"),N=u("el-button"),n=u("com-dialog");return g(),U(n,{modelValue:v.value,"onUpdate:modelValue":o[6]||(o[6]=m=>v.value=m),title:t.detail&&t.detail.id?"编辑用户":"新建用户",width:"600px","before-close":p},{action:a(()=>[l(N,{onClick:p},{default:a(()=>[y("取 消")]),_:1}),l(N,{type:"primary",onClick:e},{default:a(()=>[y("确 定")]),_:1})]),default:a(()=>[l(_,{ref_key:"formRef",ref:$,model:d,rules:w,"label-width":"100px","label-position":"left",class:"dict-form"},{default:a(()=>[l(V,{label:"邮箱/账号",prop:"email"},{default:a(()=>[l(s,{modelValue:d.email,"onUpdate:modelValue":o[0]||(o[0]=m=>d.email=m),size:"large",placeholder:"请输入邮箱",disabled:!!(t.detail&&t.detail.id)},null,8,["modelValue","disabled"])]),_:1}),l(V,{label:"角色",prop:"role"},{default:a(()=>[l(A,{modelValue:d.role,"onUpdate:modelValue":o[1]||(o[1]=m=>d.role=m),size:"large",style:{width:"100%"}},{default:a(()=>[(g(!0),S(B,null,R(h.value,(m,W)=>(g(),U(b,{key:W,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"用户名",prop:"username"},{default:a(()=>[l(s,{modelValue:d.username,"onUpdate:modelValue":o[2]||(o[2]=m=>d.username=m),size:"large",placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(V,{label:"联系电话",prop:"phone"},{default:a(()=>[l(s,{modelValue:d.phone,"onUpdate:modelValue":o[3]||(o[3]=m=>d.phone=m),size:"large",placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),l(V,{label:"chatgpt授权",prop:"config"},{default:a(()=>[l(i,{modelValue:d.config.chatgpt,"onUpdate:modelValue":o[4]||(o[4]=m=>d.config.chatgpt=m),size:"large","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),l(V,{label:"状态",prop:"status"},{default:a(()=>[l(i,{modelValue:d.status,"onUpdate:modelValue":o[5]||(o[5]=m=>d.status=m),size:"large","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),le=q({__name:"detailDialog",props:{modelValue:{type:Boolean,default:!1},detail:{default:()=>({email:"",role:2,username:"",phone:"",status:!0})}},emits:["update:modelValue","submit"],setup(F,{emit:k}){const f=F,C=k,r=new O,z=G(),c=P({get(){return f.modelValue},set(e){C("update:modelValue",e)}}),v=j([]),d=j([]);(()=>{new E().detailByPro("code","user_role").then(t=>{v.value=t.values})})(),(()=>{new E().detailByPro("code","user_gender").then(t=>{d.value=t.values})})();const h=()=>{c.value=!1},p=()=>{r.resetPwd(f.detail.id).then(e=>{z.$message({type:"success",message:"密码重置成功，重置密码为000000",duration:1e3})})};return(e,t)=>{const o=u("el-input"),s=u("el-form-item"),V=u("el-option"),b=u("el-select"),A=u("el-button"),i=u("el-switch"),_=u("el-form"),N=u("com-dialog");return g(),U(N,{modelValue:c.value,"onUpdate:modelValue":t[15]||(t[15]=n=>c.value=n),title:"查看用户",width:"800px",footerStyle:{"text-align":"center"},"before-close":h},{action:a(()=>[l(A,{type:"primary",onClick:h},{default:a(()=>[y("确 定")]),_:1})]),default:a(()=>[l(_,{model:e.detail,"label-width":"100px","label-position":"right",class:"dict-form",onSubmit:t[14]||(t[14]=Y(()=>{},["prevent"]))},{default:a(()=>[l(s,{label:"头像",prop:"avatar"},{default:a(()=>[l(o,{modelValue:e.detail.avatar,"onUpdate:modelValue":t[0]||(t[0]=n=>e.detail.avatar=n),size:"large",placeholder:"请输入头像",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"邮箱/账号",prop:"email",class:"inline"},{default:a(()=>[l(o,{modelValue:e.detail.email,"onUpdate:modelValue":t[1]||(t[1]=n=>e.detail.email=n),size:"large",placeholder:"请输入邮箱",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"角色",prop:"role",class:"inline"},{default:a(()=>[l(b,{modelValue:e.detail.role,"onUpdate:modelValue":t[2]||(t[2]=n=>e.detail.role=n),size:"large",style:{width:"100%"},readonly:""},{default:a(()=>[(g(!0),S(B,null,R(v.value,(n,m)=>(g(),U(V,{key:m,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"用户名",prop:"username",class:"inline"},{default:a(()=>[l(o,{modelValue:e.detail.username,"onUpdate:modelValue":t[3]||(t[3]=n=>e.detail.username=n),size:"large",placeholder:"请输入姓名",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"联系电话",prop:"phone",class:"inline"},{default:a(()=>[l(o,{modelValue:e.detail.phone,"onUpdate:modelValue":t[4]||(t[4]=n=>e.detail.phone=n),size:"large",placeholder:"请输入联系电话",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"职业",prop:"major",class:"inline"},{default:a(()=>[l(o,{modelValue:e.detail.major,"onUpdate:modelValue":t[5]||(t[5]=n=>e.detail.major=n),size:"large",placeholder:"请输入职业",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"性别",prop:"gender",class:"inline"},{default:a(()=>[l(b,{modelValue:e.detail.gender,"onUpdate:modelValue":t[6]||(t[6]=n=>e.detail.gender=n),size:"large",style:{width:"100%"},readonly:""},{default:a(()=>[(g(!0),S(B,null,R(d.value,(n,m)=>(g(),U(V,{key:m,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(s,{label:"创建时间",prop:"createdAt",class:"inline"},{default:a(()=>[l(o,{modelValue:e.detail.createdAt,"onUpdate:modelValue":t[7]||(t[7]=n=>e.detail.createdAt=n),size:"large",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"更新时间",prop:"updatedAt",class:"inline"},{default:a(()=>[l(o,{modelValue:e.detail.updatedAt,"onUpdate:modelValue":t[8]||(t[8]=n=>e.detail.updatedAt=n),size:"large",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"地址",prop:"address",class:"inline"},{default:a(()=>[l(o,{modelValue:e.detail.address,"onUpdate:modelValue":t[9]||(t[9]=n=>e.detail.address=n),size:"large",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"密码",prop:"address",class:"inline"},{default:a(()=>[l(o,{value:"●●●●●●●●●●●●●",size:"large",readonly:""},{append:a(()=>[l(A,{type:"primary",onClick:p},{default:a(()=>[y("重置密码")]),_:1})]),_:1})]),_:1}),l(s,{label:"更新时间",prop:"updatedAt",class:"inline"},{default:a(()=>[l(o,{modelValue:e.detail.updatedAt,"onUpdate:modelValue":t[10]||(t[10]=n=>e.detail.updatedAt=n),size:"large",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"用户状态",prop:"status",class:"inline"},{default:a(()=>[l(i,{modelValue:e.detail.status,"onUpdate:modelValue":t[11]||(t[11]=n=>e.detail.status=n),size:"large",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"邮箱验证状态",prop:"emailVerified",class:"inline"},{default:a(()=>[l(i,{modelValue:e.detail.emailVerified,"onUpdate:modelValue":t[12]||(t[12]=n=>e.detail.emailVerified=n),size:"large",readonly:""},null,8,["modelValue"])]),_:1}),l(s,{label:"个人简介",prop:"desc"},{default:a(()=>[l(o,{modelValue:e.detail.desc,"onUpdate:modelValue":t[13]||(t[13]=n=>e.detail.desc=n),size:"large",type:"textarea",rows:4,readonly:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),te={class:"backstage-account-user"},ae=I("span",{class:"status-dot"},null,-1),oe={class:"status-text"},se=q({__name:"index",setup(F){const k=G(),f=new O,C=T(),r=D({page:1,size:10,total:0,config:x,filters:{search:"",role:0},data:[]});let z=D({data:null});const c=D({edit:!1,detail:!1}),v=P(()=>(C.dicts.find(e=>e.code==="user_role").values||[]).reduce((e,t,o,s)=>(e[t.value]=t.label,e),{})),d=()=>{f.find({page:r.page,size:r.size,...r.filters}).then(p=>{r.total=p.total,r.data=p.items.map(e=>(e.role_name=v.value[e.role],e.createdAt=J(e.createdAt),e.updatedAt=J(e.updatedAt),e))})};d();const w=(p,e)=>{z.data=p,c[e]=!0,e==="delete"&&Q("删除用户将会把用户关联数据一并删除，确定要删除吗").then(t=>{f.delete(p.id).then(o=>{k.$message({message:"删除成功",type:"success",duration:1e3}),d()})}),e==="disable"&&f.toggleStatus(p.id).then(t=>{k.$message({message:"操作成功",type:"success",duration:1e3}),d()})},$=()=>{H(r,d)},h=()=>{for(let p in r.filters)typeof r.filters[p]=="number"&&!["role"].includes(p)?r.filters[p]=0:r.filters[p]="";d()};return(p,e)=>{const t=u("el-input"),o=u("filter-item"),s=u("el-option"),V=u("el-select"),b=u("el-button"),A=u("table-page");return g(),S(B,null,[I("div",te,[l(A,{"table-data":r,onFilter:$,onReset:h,"is-index":!0,border:!0,onPageChange:d,actionWidth:260},{filter:a(()=>[l(o,{text:"搜索:"},{default:a(()=>[l(t,{modelValue:r.filters.search,"onUpdate:modelValue":e[0]||(e[0]=i=>r.filters.search=i),placeholder:"请输入搜索内容",onInput:d},null,8,["modelValue"])]),_:1}),l(o,{text:"角色:"},{default:a(()=>[l(V,{modelValue:r.filters.role,"onUpdate:modelValue":e[1]||(e[1]=i=>r.filters.role=i),onChange:d},{default:a(()=>[l(s,{label:"全部",value:0}),(g(!0),S(B,null,R(v.value,(i,_)=>(g(),U(s,{key:_,label:i,value:parseInt(_)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),chatgpt:a(i=>[I("div",{class:Z(i.config&&i.config.chatgpt?"status-success":"status-danger")},[ae,I("span",oe,M(i.config&&i.config.chatgpt?"启用":"禁用"),1)],2)]),action:a(()=>[l(b,{type:"primary",onClick:e[2]||(e[2]=i=>w(null,"edit"))},{default:a(()=>[y("新增")]),_:1})]),tableAction:a(({row:i})=>[l(b,{type:"primary",size:"small",onClick:_=>w(i,"edit")},{default:a(()=>[y("编辑")]),_:2},1032,["onClick"]),l(b,{type:"success",size:"small",onClick:_=>w(i,"detail")},{default:a(()=>[y("查看")]),_:2},1032,["onClick"]),l(b,{type:i.status?"warning":"info",size:"small",onClick:_=>w(i,"disable")},{default:a(()=>[y(M(i.status?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(b,{type:"danger",size:"small",onClick:_=>w(i,"delete")},{default:a(()=>[y("删除")]),_:2},1032,["onClick"])]),_:1},8,["table-data"])]),c.edit?(g(),U(ee,{key:0,modelValue:c.edit,"onUpdate:modelValue":e[3]||(e[3]=i=>c.edit=i),detail:L(z).data,onSubmit:d},null,8,["modelValue","detail"])):K("",!0),c.detail?(g(),U(le,{key:1,modelValue:c.detail,"onUpdate:modelValue":e[4]||(e[4]=i=>c.detail=i),detail:L(z).data},null,8,["modelValue","detail"])):K("",!0)],64)}}});export{se as default};
