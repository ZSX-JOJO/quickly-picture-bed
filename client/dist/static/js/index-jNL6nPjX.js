import{d as Y,H as se,_ as Q,u as ie,l as me,e as fe,f as ge,a as ve,g as ae,i as be,j as he,k as ke,m as oe}from"./index-lYYcvhZ6.js";import{B as ye}from"./Bucket-GNIK0PFr.js";import{f as J,r as G,K as F,i as f,o as i,g as h,F as j,C as W,v as R,x as c,A as D,B as L,I as e,h as l,a8 as X,a9 as Z,aa as ne,z as E,$ as re,y as $e,s as Ce,L as P,S as xe,J as we,D as O,n as Ie,a5 as ue,a as le,ab as Se,w as Be,M as ze,p as ce,Y as De}from"./vendor-DwjfiTos.js";import{I as de}from"./Image-RN-sZ7Xy.js";import{A as He}from"./Album-0Te0fKlD.js";const Ue=u=>(X("data-v-8451658c"),u=u(),Z(),u),Te=Ue(()=>e("div",{class:"bucket-title"},"选择存储桶",-1)),Le={key:0,class:"bucket-list"},Fe={key:1,class:"bucket-list"},Ve={class:"empty-bucket"},Ee=J({__name:"bucket-select",props:{userHabits:{default:()=>({link_format:"URL"})}},emits:["update:userHabits"],setup(u,{emit:I}){const _=new ye,p=new se,m=u,S=I,y=Y(),g=G([]),a=F({get:()=>m.userHabits,set:r=>S("update:userHabits",r)});(()=>{_.find({visible:!0,is_only_names:!0}).then(r=>{g.value=r.items,y.updateUserBuckets(g.value)})})();const v=async r=>{a.value.current_bucket=r.id,await p.save({id:a.value.id,current_bucket:a.value.current_bucket})};return(r,B)=>{const o=f("el-tag"),d=f("router-link");return i(),h(j,null,[Te,g.value.length?(i(),h("div",Le,[(i(!0),h(j,null,W(g.value,(s,z)=>(i(),R(o,{key:"bucket-"+z,size:"large",type:"info",effect:s.id===a.value.current_bucket?"dark":"light",onClick:U=>v(s)},{default:c(()=>[D(L(s.name),1)]),_:2},1032,["effect","onClick"]))),128))])):(i(),h("div",Fe,[e("p",Ve,[D(" 暂无存储桶可选，请前往"),l(d,{to:"/bucket"},{default:c(()=>[D("存储桶")]),_:1}),D("页创建 ")])]))],64)}}}),Me=Q(Ee,[["__scopeId","data-v-8451658c"]]),Ae=u=>(X("data-v-8830174f"),u=u(),Z(),u),Re=Ae(()=>e("div",{class:"bucket-title"},"链接格式",-1)),je=["onClick"],qe=["onClick"],Pe=["onClick"],Ne=J({__name:"bucket-copy",props:{userHabits:{default:()=>({link_format:"URL"})}},emits:["update:userHabits"],setup(u,{emit:I}){const _=ie(),p=u,m=I,S=Y(),y=new se,g=F({get:()=>p.userHabits,set:s=>m("update:userHabits",s)}),a=F(()=>S.currentImages),$=F(()=>me.value.map(s=>(s.id==="custom"&&(s.value=g.value.link_format),s))),v=s=>a.value.sort((U,M)=>U.sort-M.sort).map(U=>{const M=U.preview_url,A={url:M||"",filename:U.name};return s.value.replace(/\$\{(.*?)\}/g,(K,q)=>A[q])}).join(`
`),r=s=>{o(v(s))};function B(s){o(s)}function o(s){a.value.length&&fe(_,s)}const d=async s=>{g.value.id&&await y.save({id:g.value.id,pasteStyle:s})};return(s,z)=>{const U=f("el-tooltip"),M=f("CopyDocument"),A=f("el-icon"),K=f("el-tab-pane"),q=f("el-tabs");return i(),h(j,null,[Re,l(q,{modelValue:g.value.pasteStyle,"onUpdate:modelValue":z[0]||(z[0]=V=>g.value.pasteStyle=V),type:"border-card",class:"bucket-copy-tabs",onTabChange:d},{default:c(()=>[(i(!0),h(j,null,W($.value,(V,ee)=>(i(),R(K,{key:"linkType-"+ee,label:V.label,name:V.id},{default:c(()=>[e("div",{class:"links-copy",onClick:N=>r(V)},[e("span",null,[a.value.length?(i(!0),h(j,{key:0},W(v(V).split(`
`),(N,t)=>(i(),R(U,{key:t,content:"复制该项链接",placement:"top"},{default:c(()=>[e("p",{onClick:ne(n=>B(N),["stop"])},L(N),9,qe)]),_:2},1024))),128)):E("",!0)]),l(U,{content:"复制全部链接",placement:"left"},{default:c(()=>[e("span",{class:"link-copy-btn",onClick:ne(N=>r(V),["stop"])},[l(A,{size:"18"},{default:c(()=>[l(M)]),_:1})],8,Pe)]),_:2},1024)],8,je)]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])],64)}}}),Ge=Q(Ne,[["__scopeId","data-v-8830174f"]]),Je={},Ke=u=>(X("data-v-46f068d6"),u=u(),Z(),u),We={t:"1693287319690",class:"icon",viewBox:"0 0 1000 1000",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4065","xmlns:xlink":"http://www.w3.org/1999/xlink"},Ye=Ke(()=>e("path",{d:"M365.714286 438.857143a73.142857 73.142857 0 1 1 0-146.285714 73.142857 73.142857 0 0 1 0 146.285714z m0 292.571428a73.142857 73.142857 0 1 1 0-146.285714 73.142857 73.142857 0 0 1 0 146.285714z m0 292.571429a73.142857 73.142857 0 1 1 0-146.285714 73.142857 73.142857 0 0 1 0 146.285714zM658.285714 146.285714a73.142857 73.142857 0 1 1 0-146.285714 73.142857 73.142857 0 0 1 0 146.285714z m0 292.571429a73.142857 73.142857 0 1 1 0-146.285714 73.142857 73.142857 0 0 1 0 146.285714z m0 292.571428a73.142857 73.142857 0 1 1 0-146.285714 73.142857 73.142857 0 0 1 0 146.285714z m0 292.571429a73.142857 73.142857 0 1 1 0-146.285714 73.142857 73.142857 0 0 1 0 146.285714zM365.714286 146.285714a73.142857 73.142857 0 1 1 0-146.285714 73.142857 73.142857 0 0 1 0 146.285714z","p-id":"4066"},null,-1)),Oe=[Ye];function Qe(u,I){return i(),h("svg",We,Oe)}const Xe=Q(Je,[["render",Qe],["__scopeId","data-v-46f068d6"]]),Ze=u=>(X("data-v-d859bd3e"),u=u(),Z(),u),et=Ze(()=>e("div",{class:"bucket-title"},"预览专区",-1)),tt=["data-id"],st={class:"drag-item-main"},at={class:"drag-item-icon"},ot={class:"drag-item-img"},nt=["src"],lt={class:"drag-item-content"},ct={class:"drag-item-filename"},it={class:"drag-item-filesize"},rt={class:"drag-item-action"},ut=["onClick"],dt=J({__name:"image-drag",setup(u){const I=G(null),_=G(null),p=Y(),m=F(()=>p.currentImages),S=G(!1);function y(){_.value=xe.create(I.value,{handle:".drag-item-icon",draggable:".drag-item",ghostClass:"ghost",chosenClass:"chosen",dragClass:"drag",onEnd:a=>{const{oldIndex:$,newIndex:v}=a,[r,B]=[m.value[$],m.value[v]];S.value=!0,new de().sort(r.id,B.id).then(()=>{p.currentImages.splice($,1,B),p.currentImages.splice(v,1,r),S.value=!1})},onMove:(a,$)=>{a.dragged.dataset.id,a.related.dataset.id}})}function g(a){const $=p.currentImages.findIndex(v=>v.id===a.id);p.currentImages.splice($,1)}return re(()=>{y()}),(a,$)=>{const v=f("DeleteFilled"),r=f("el-icon"),B=f("el-tooltip"),o=$e("loading");return i(),h(j,null,[et,Ce((i(),h("div",{class:"bucket-drag-box",ref_key:"sortableRef",ref:I},[(i(!0),h(j,null,W(m.value,d=>(i(),h("div",{class:"drag-item",key:d.id,"data-id":d.id},[e("div",st,[e("div",at,[l(Xe)]),e("div",ot,[e("img",{src:d.preview_url,alt:""},null,8,nt)]),e("div",lt,[e("div",ct,L(d.name),1),e("div",it,L(P(ge)(d.size)),1)]),e("div",rt,[l(B,{effect:"dark",content:"移除当前记录，并不删除实际数据，如需删除请前往图库删除",placement:"top"},{default:c(()=>[e("div",{class:"drag-item-action-item",onClick:s=>g(d)},[l(r,null,{default:c(()=>[l(v)]),_:1})],8,ut)]),_:2},1024)])])],8,tt))),128))])),[[o,S.value]])],64)}}}),pt=Q(dt,[["__scopeId","data-v-d859bd3e"]]),_t="/loading.gif",mt={class:"c-upload"},ft={key:0,class:"c-upload__progress"},gt={class:"c-upload__content"},vt=["multiple","accept"],bt={class:"c-upload__action"},ht=J({__name:"index",props:{accept:{default:()=>["*"]},limit:{default:1},multiple:{type:Boolean,default:!0}},emits:["upload"],setup(u,{emit:I}){const _=u,p=I,m=we(),S=F(()=>"."+_.accept.join(",.")),y=G(!1),g=G(),a=()=>{g.value.click()},$=o=>{o.target.files.length<=_.limit?p("upload",{files:o.target.files}):p("upload",{error:"选择文件长度超出数量限制"}),g.value.value=""},v=o=>{o.preventDefault(),o.stopPropagation(),y.value=!1;const d=o.dataTransfer.files;d.length<=_.limit?p("upload",{files:d}):p("upload",{error:"选择文件长度超出数量限制"})},r=o=>{o.preventDefault(),o.stopPropagation(),y.value=!0},B=o=>{o.preventDefault(),o.stopPropagation(),y.value=!1};return(o,d)=>(i(),h("div",mt,[P(m).progress?(i(),h("div",ft,[O(o.$slots,"progress")])):E("",!0),e("div",gt,[e("div",{class:Ie(["c-upload-dragger",y.value?"is-dragover":""]),onDrop:v,onDragover:r,onDragleave:B,onClick:a},[O(o.$slots,"default")],34),e("input",{type:"file",name:"file",multiple:o.multiple,ref_key:"file",ref:g,accept:S.value,class:"c-upload__input",onChange:$},null,40,vt)]),e("div",bt,[O(o.$slots,"action")]),O(o.$slots,"tip")]))}}),kt={class:"custom-card-box"},yt={class:"custom-card-album"},$t={class:"title"},Ct={class:"desc"},xt={class:"custom-card-upload"},wt={key:0,class:"custom-upload-loading"},It=e("img",{src:_t,alt:""},null,-1),St={key:0},Bt={key:1},zt={class:"el-upload__text"},Dt=e("p",null,"点击上传图片，支持拖拽上传",-1),Ht={class:"c-upload__tip"},Ut=e("span",null,"支持直接 Ctrl + V 上传",-1),Tt=e("div",{class:"entry-title"},"快捷上传: ",-1),Lt=J({__name:"bucket-upload",props:{userHabits:{default:()=>({link_format:"URL"})}},emits:["update:userHabits","success"],setup(u,{emit:I}){const _=ie(),p=u,m=I,S=ve(),y=Y(),g=new de,a=new He,$=new se,v=ue(),{album_id:r,img_id:B}=v.query,o=F({get:()=>p.userHabits,set:t=>m("update:userHabits",t)}),d=F(()=>{const t=S.systemConfig;return t.system.accept_str="."+t.system.accept.join(",."),t}),s=le({progress:0}),z=le({active_id:r?parseInt(r):o.value.current_album,data:[]}),U=t=>{if(t.error)return _.$message({message:t.error,duration:1e3,type:"error"});const n=[],k=[];for(let w=0;w<t.files.length;w++){const b=t.files[w],C=b.size/1024/1024,x=ae(b.name),H=d.value.system;C<H.maxsize&&H.accept.includes(x)?n.push(b):k.push(b)}s.progress=0,M(n,k)},M=(t,n=[])=>{const k=o.value.current_bucket,w=y.user_buckets.map(C=>C.id);if(!w.length)return _.$message({message:"请先创建存储桶",duration:1e3,type:"warning"});if(!k||!w.includes(k))return _.$message({message:"请先选择存储桶，然后再上传",duration:1e3,type:"warning"});V(n);const b=new FormData;b.append("bucket_id",k.toString()),B&&b.append("image_id",B.toString()),z.active_id&&b.append("album_id",z.active_id.toString()),t.forEach(C=>{b.append("files",C)}),g.upload(b,({loaded:C,total:x,percent:H})=>{s.progress=H}).then(C=>{_.$message({message:"上传成功",duration:1e3,type:"success"}),m("success"),C.forEach(x=>{x.preview_url=x.baseurl+x.url;const H=y.currentImages.findIndex(te=>te.id===x.id);B||H!==-1?y.currentImages.splice(H,1,x):y.currentImages.push(x)})}).catch(C=>{_.$notify({title:"插件运行错误提示",message:C.data,type:"error",duration:1e3})}).finally(()=>{s.progress=0})};function A(t){if(t.length!==0){if(t.length>=d.value.system.maxcount)return _.$message({message:"上传文件长度超出数量限制",duration:1e3,type:"error"});U({files:t,error:""})}}const K=t=>{be(t).then(n=>{A(n)})},q=t=>{t==="clipboard"&&he().then(n=>{A(n)}).catch(n=>{_.$message({message:n.message,type:"error",duration:1e3})}),t==="url"&&ce.prompt("请输入网络图片url","网络图片上传",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"请输入图片url"}).then(({value:n})=>{ke(n,oe()+".png",d.value.system.accept).then(k=>{A([k])}).catch(k=>{_.$notify({title:"错误提示",message:k.message,type:"error",duration:1e3})})}).catch(()=>{}),t==="base64"&&ce.prompt("请输入图片的base64编码内容","Bas64图片上传",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea",inputPlaceholder:"请输入图片的base64编码内容"}).then(({value:n})=>{const k=atob(n.replace(/^data:.+;base64,/,"")),w=new Uint8Array(k.length);for(let x=0;x<k.length;x++)w[x]=k.charCodeAt(x);const b=new Blob([w],{type:"image/jpeg"}),C=new File([b],oe()+".png",{type:"image/png"});A([C])}).catch(()=>{})},V=t=>{t.forEach(n=>{const k=S.systemConfig.system;setTimeout(()=>{let w="";const b=n.size/1024/1024,C=ae(n.name);b>k.maxsize&&(w+=`${n.name}大小${b.toFixed(2)}MB不符合要求`),k.accept.includes(C)||(w+=`${n.name}格式${C}不符合要求`),_.$notify({title:"错误提示",message:w,type:"error",duration:1e3})},0)})};function ee(){a.find({sort:"sort",order:"desc"}).then(t=>{z.data=[{id:0,name:"图库",desc:"不放进任何相册中"},...t.items]})}ee();const N=async t=>{o.value.current_album=t,await $.save({id:o.value.id,current_album:t})};return re(()=>{document.addEventListener("paste",K)}),Se(()=>{document.removeEventListener("paste",K)}),Be(()=>s.progress,t=>{t!==0&&console.log("总进度：",s.progress)},{deep:!0}),(t,n)=>{const k=f("el-option"),w=f("el-select"),b=f("el-tooltip"),C=f("el-progress"),x=f("upload-filled"),H=f("el-icon"),te=f("Edit"),pe=f("Connection"),_e=f("HelpFilled");return i(),h("div",kt,[e("div",yt,[l(b,{effect:"dark",content:"将图片上传到指定相册中",placement:"right"},{default:c(()=>[l(w,{modelValue:z.active_id,"onUpdate:modelValue":n[0]||(n[0]=T=>z.active_id=T),placeholder:"相册选择",style:{width:"180px"},"popper-class":"album-select-popper",onChange:n[1]||(n[1]=T=>N(z.active_id))},{default:c(()=>[(i(!0),h(j,null,W(z.data,(T,jt)=>(i(),R(k,{key:T.id,label:T.name,value:T.id},{default:c(()=>[e("p",$t,L(T.name),1),e("p",Ct,L(T.desc),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),e("div",xt,[s.progress?(i(),h("div",wt,[It,e("p",null,[s.progress<100?(i(),h("span",St,"正在上传图片...")):E("",!0),s.progress===100?(i(),h("span",Bt,"正在将图片转存到存储桶...")):E("",!0)])])):E("",!0),l(ht,{accept:d.value.system.accept,limit:d.value.system.maxcount,multiple:t.$route.query.img_id?!1:d.value.system.maxcount>1,onUpload:U},ze({tip:c(()=>[e("div",Ht,[D(" 大小不超过 "),e("span",null,L(d.value.system.maxsize)+"MB",1),D(" 的 "),e("span",null,L(d.value.system.accept.join(", ")),1),D(" 文件, "),Ut])]),action:c(()=>[Tt,l(b,{effect:"dark",content:"如果不支持，可以尝试直接按Ctrl + V",placement:"bottom"},{default:c(()=>[e("div",{class:"btn-link btn-link-clip",onClick:n[2]||(n[2]=T=>q("clipboard"))},[l(H,null,{default:c(()=>[l(te)]),_:1}),D("剪切板上传 ")])]),_:1}),l(b,{effect:"dark",content:"将网络图片保存到系统中",placement:"bottom"},{default:c(()=>[e("div",{class:"btn-link btn-link-network",onClick:n[3]||(n[3]=T=>q("url"))},[l(H,null,{default:c(()=>[l(pe)]),_:1}),D("URL远程上传 ")])]),_:1}),l(b,{effect:"dark",content:"将Base64编码的图片保存到系统中",placement:"bottom"},{default:c(()=>[e("div",{class:"btn-link btn-link-base64",onClick:n[4]||(n[4]=T=>q("base64"))},[l(H,null,{default:c(()=>[l(_e)]),_:1}),D("Base64上传 ")])]),_:1})]),default:c(()=>[l(H,{class:"el-icon--upload"},{default:c(()=>[l(x)]),_:1}),e("div",zt,[Dt,e("p",null,"支持同时上传最多 "+L(d.value.system.maxcount)+" 张图片，单个文件最大 "+L(d.value.system.maxsize)+" MB",1)])]),_:2},[s.progress?{name:"progress",fn:c(()=>[l(C,{percentage:s.progress},null,8,["percentage"])]),key:"0"}:void 0]),1032,["accept","limit","multiple"])])])}}}),Ft={class:"home-container"},Vt={class:"home-title"},Et=e("span",null,"让存储变得简单有效",-1),Mt=e("span",null,null,-1),At=e("div",{class:"home-tips"},"严禁上传包含反动、暴力、色情、违法、及侵权内容的文件。",-1),Rt={class:"copy-history"},Kt=J({__name:"index",setup(u){const I=Y(),_=De(),p=ue(),m=F(()=>I.user_habits.data),S=F(()=>I.currentImages),y=()=>{_.back()};return(g,a)=>{const $=f("el-button"),v=f("el-card");return i(),h("div",Ft,[e("div",Vt,[Et,Mt,P(p).query.from?(i(),R($,{key:0,type:"success",onClick:a[0]||(a[0]=()=>g.$router.back())},{default:c(()=>[D("返回列表")]),_:1})):E("",!0),P(p).query.album_id&&!P(p).query.from?(i(),R($,{key:1,type:"success",onClick:y},{default:c(()=>[D("返回相册")]),_:1})):E("",!0),!P(p).query.album_id&&P(p).query.img_id?(i(),R($,{key:2,type:"success",onClick:y},{default:c(()=>[D("返回图库")]),_:1})):E("",!0)]),At,l(v,{class:"bucket-select-card"},{default:c(()=>[l(Me,{"user-habits":m.value,"onUpdate:userHabits":a[1]||(a[1]=r=>m.value=r)},null,8,["user-habits"])]),_:1}),e("div",Rt,[l(v,{class:"custom-card upload-card"},{default:c(()=>[l(Lt,{"user-habits":m.value,"onUpdate:userHabits":a[2]||(a[2]=r=>m.value=r)},null,8,["user-habits"])]),_:1}),S.value.length?(i(),R(v,{key:0,class:"drag-card"},{default:c(()=>[l(pt,{"user-habits":m.value,"onUpdate:userHabits":a[3]||(a[3]=r=>m.value=r)},null,8,["user-habits"])]),_:1})):E("",!0)]),l(v,{class:"copy-card",style:{"margin-top":"15px"}},{default:c(()=>[l(Ge,{"user-habits":m.value,"onUpdate:userHabits":a[4]||(a[4]=r=>m.value=r)},null,8,["user-habits"])]),_:1})])}}});export{Kt as default};
