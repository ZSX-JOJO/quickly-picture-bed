import{_ as L,V as O,a as K}from"./email-options.vue_vue_type_script_setup_true_lang-z14TXRDu.js";import{u as E,U as T,a as M}from"./index-LJ8e8yHT.js";import{f as B,Y as A,r as h,Z as k,a as C,$ as Y,k as Z,i as d,o as $,v as U,x as o,h as s,I as v,A as g,K as F,y as j,s as H,B as P,z as D}from"./vendor-DwjfiTos.js";const Q=["src"],W=B({__name:"login-password",setup(N){const I=new T,f=new O,y=A(),_=E(),c=h(!1),u=k.get("email"),e=C({username:u||"",username_suffix:"@163.com",password:k.get("password")||"",verify_code:"",verify_id:"",remember:JSON.parse(k.get("remember")||"true")});if(u){const n=u.lastIndexOf("@");e.username=u.slice(0,n),e.username_suffix=u.slice(n,u.length)}const t=h(),q=C({username:[{required:!0,message:"请输入邮箱账号",trigger:["blur"]}],password:[{required:!0,message:"请输入密码",trigger:["blur"]}],verify_code:[{required:!0,message:"请输入验证码",trigger:["blur"]}]}),p=C({id:"-",code:""}),a=()=>{t.value&&t.value.validate(n=>{n&&(c.value=!0,I.login({email:e.username+e.username_suffix,password:e.password,verify_id:e.verify_id,verify_code:e.verify_code}).then(r=>{e.remember&&(k.set("email",e.username+e.username_suffix),k.set("password",e.password)),localStorage.setItem("token",r.token),_.$message({message:"登录成功",type:"success",duration:1e3}),y.push({path:"/"})}).catch(r=>{_.$message({message:r.message,type:"error",duration:1e3}),V(),c.value=!1}))})},V=()=>{f.create({last_id:p.id?p.id:"-"}).then(n=>{p.id=n.id,p.code=n.data,e.verify_id=n.id})};return V(),Y(()=>{Z("enter",()=>(a(),!1)),document.addEventListener("keydown",n=>{(n.key==="Enter"||n.keyCode===13)&&(n.preventDefault(),a())})}),(n,r)=>{const R=d("el-select"),i=d("el-input"),l=d("el-form-item"),z=d("el-checkbox"),w=d("router-link"),b=d("el-button"),S=d("el-form");return $(),U(S,{model:e,rules:q,ref_key:"formRef",ref:t,class:"login-form"},{default:o(()=>[s(l,{prop:"username"},{default:o(()=>[s(i,{modelValue:e.username,"onUpdate:modelValue":r[1]||(r[1]=m=>e.username=m),"prefix-icon":"User",placeholder:"邮箱账号",size:"large"},{append:o(()=>[s(R,{modelValue:e.username_suffix,"onUpdate:modelValue":r[0]||(r[0]=m=>e.username_suffix=m),placeholder:"请选择邮箱类型",style:{width:"120px"},size:"large"},{default:o(()=>[s(L)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),s(l,{prop:"password"},{default:o(()=>[s(i,{modelValue:e.password,"onUpdate:modelValue":r[2]||(r[2]=m=>e.password=m),"prefix-icon":"Lock","show-password":"",placeholder:"密码",size:"large"},null,8,["modelValue"])]),_:1}),s(l,{class:"verify-code",prop:"verify_code",style:{"margin-bottom":"10px"}},{default:o(()=>[s(i,{modelValue:e.verify_code,"onUpdate:modelValue":r[3]||(r[3]=m=>e.verify_code=m),placeholder:"请输入验证码",size:"large"},null,8,["modelValue"]),v("img",{src:p.code,title:"看不清，点击图片换一张",alt:"",onClick:V},null,8,Q)]),_:1}),s(l,{prop:"remember",class:"register-enter"},{default:o(()=>[s(z,{modelValue:e.remember,"onUpdate:modelValue":r[4]||(r[4]=m=>e.remember=m)},{default:o(()=>[g("记住密码")]),_:1},8,["modelValue"]),v("span",null,[s(w,{to:"/register"},{default:o(()=>[g("新注册账号")]),_:1}),s(w,{to:"/forget"},{default:o(()=>[g("找回密码")]),_:1})])]),_:1}),s(l,{class:"login_btn"},{default:o(()=>[s(b,{loading:c.value,type:"primary",size:"large",onClick:a},{default:o(()=>[g("登 录")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}}),X=["src"],ee=v("span",null,null,-1),se=B({__name:"login-verifycode",setup(N){const I=new T,f=A(),y=E(),_=new O,c=h(!1),u=h(!1),e=k.get("email"),t=C({username:e||"",username_suffix:"@163.com",password:localStorage.getItem("password")||"",remember:!1,verify_code:"",sms_code:"",verify_id:""});if(e){const i=e.lastIndexOf("@");t.username=e.slice(0,i),t.username_suffix=e.slice(i,e.length)}const q=C({username:[{required:!0,message:"请输入邮箱账号",trigger:["blur"]}],verify_code:[{required:!0,message:"请输入图形验证码",trigger:["blur"]}],sms_code:[{required:!0,message:"请输入邮箱验证码",trigger:["blur"]}]}),p=h(),a=C({id:"-",code:"",msg:"获取验证码",counter:60}),V=F(()=>t.username+t.username_suffix),n=()=>{p.value.validate(i=>{i&&(c.value=!0,I.login({email:V.value,sms_code:t.sms_code,type:"verify_code"}).then(l=>{c.value=!1,k.set("email",V.value),localStorage.setItem("token",l.token),y.$message({message:"登录成功",type:"success",duration:1e3}),f.push({path:"/"})}).catch(l=>{y.$message({message:l.message,type:"error",duration:1e3}),l.message!=="验证码不正确"&&r(),c.value=!1}))})},r=()=>{_.create({last_id:a.id?a.id:"-"}).then(i=>{a.id=i.id,a.code=i.data,t.verify_id=i.id})};r();const R=()=>{p.value.validateField(["username","verify_code"],i=>{i&&(u.value=!0,_.smsSend({account:V.value,verify_id:t.verify_id,verify_code:t.verify_code,type:"email"}).then(l=>{y.$message({message:"验证码发送成功",duration:1e3,type:"success"}),a.msg="验证码发送成功",u.value=!1;let z=setInterval(()=>{a.counter<=0?(clearInterval(z),a.msg="重新获取验证码",a.counter=60):(a.counter--,a.msg=`${a.counter}秒后可重发`)},1e3)}).catch(l=>{y.$message({message:l.message,type:"error",duration:1e3}),u.value=!1}))})};return(i,l)=>{const z=d("el-select"),w=d("el-input"),b=d("el-form-item"),S=d("el-button"),m=d("router-link"),G=d("el-form"),J=j("loading");return $(),U(G,{model:t,rules:q,ref_key:"formRef",ref:p,class:"login-form"},{default:o(()=>[s(b,{prop:"username"},{default:o(()=>[s(w,{modelValue:t.username,"onUpdate:modelValue":l[1]||(l[1]=x=>t.username=x),"prefix-icon":"Cellphone",placeholder:"邮箱账号",size:"large"},{append:o(()=>[s(z,{modelValue:t.username_suffix,"onUpdate:modelValue":l[0]||(l[0]=x=>t.username_suffix=x),placeholder:"请选择邮箱类型",style:{width:"120px"},size:"large"},{default:o(()=>[s(L)]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),s(b,{class:"verify-code",prop:"verify_code"},{default:o(()=>[s(w,{modelValue:t.verify_code,"onUpdate:modelValue":l[2]||(l[2]=x=>t.verify_code=x),placeholder:"请输入图形验证码",size:"large"},null,8,["modelValue"]),v("img",{src:a.code,title:"看不清，点击图片换一张",alt:"",onClick:r},null,8,X)]),_:1}),s(b,{class:"email-code",prop:"sms_code"},{default:o(()=>[s(w,{modelValue:t.sms_code,"onUpdate:modelValue":l[3]||(l[3]=x=>t.sms_code=x),placeholder:"请输入邮箱验证码",size:"large"},{suffix:o(()=>[H(($(),U(S,{text:"",type:"primary",onClick:R,disabled:a.counter!==60},{default:o(()=>[g(P(a.msg),1)]),_:1},8,["disabled"])),[[J,u.value]])]),_:1},8,["modelValue"])]),_:1}),s(b,{prop:"remember",class:"register-enter"},{default:o(()=>[ee,v("span",null,[s(m,{to:"/register"},{default:o(()=>[g("新注册账号")]),_:1}),s(m,{to:"/forget"},{default:o(()=>[g("找回密码")]),_:1})])]),_:1}),s(b,{class:"login_btn"},{default:o(()=>[s(S,{loading:c.value,type:"primary",size:"large",onClick:n},{default:o(()=>[g("登 录")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])}}}),oe={class:"login-header"},te=["src"],le=v("p",null,"图片上传+管理新体验的轻量级图片管理系统、图床系统",-1),ie=B({__name:"login",setup(N){const I=M(),f=h("first"),y=F(()=>{const _=I.systemConfig.website;return _?_.logo:new URL("/static/png/logo-Bvu7GL6O.png",import.meta.url).href});return(_,c)=>{const u=d("el-tab-pane"),e=d("el-tabs");return $(),U(K,null,{default:o(()=>[v("div",oe,[v("div",null,[v("img",{src:y.value,alt:""},null,8,te),g(" 轻快图片管理系统")]),le]),s(e,{class:"type-tabs",modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=t=>f.value=t)},{default:o(()=>[s(u,{label:"账号密码登录",name:"first"},{default:o(()=>[f.value==="first"?($(),U(W,{key:"first-"+f.value})):D("",!0)]),_:1}),s(u,{label:"验证码登录",name:"second"},{default:o(()=>[f.value==="second"?($(),U(se,{key:"second-"+f.value})):D("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});export{ie as default};
